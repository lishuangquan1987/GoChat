# GoChat 表情包功能实现计划

- [ ] 1. 扩展消息数据模型和类型系统
  - 在客户端创建新的消息类型枚举，添加 EMOJI 和 STICKER 类型
  - 实现 StickerMessageContent 数据类，包含贴纸ID、包ID、图片路径等字段
  - 更新现有的 Message DTO 类以支持贴纸内容字段
  - _Requirements: 2.2, 9.1, 9.2_

- [ ] 2. 创建贴纸资源管理系统
  - [ ] 2.1 实现 StickerManager 单例类
    - 编写贴纸包加载逻辑，从 assets 目录读取配置文件
    - 实现图片缓存机制，使用 LRU 算法管理内存
    - 添加异步图片加载方法，支持错误处理和重试
    - _Requirements: 7.1, 7.2, 7.3_

  - [ ] 2.2 创建贴纸数据模型类
    - 实现 StickerPack 类，包含ID、名称、图标路径、贴纸列表
    - 实现 StickerItem 类，包含贴纸的基本信息和元数据
    - 添加 JSON 序列化和反序列化支持
    - _Requirements: 3.1, 3.2_

  - [ ] 2.3 准备贴纸资源文件
    - 在 assets 目录创建贴纸包文件夹结构
    - 添加至少 3 个不同主题的贴纸包（可爱、搞笑、动物）
    - 创建每个贴纸包的配置 JSON 文件
    - _Requirements: 3.1, 7.4_

- [ ] 3. 增强表情选择器组件
  - [ ] 3.1 扩展现有 EmojiPicker 组件
    - 添加贴纸标签页到现有的表情分类中
    - 实现贴纸网格显示，支持不同尺寸的贴纸
    - 添加贴纸选择回调函数，区别于表情符号选择
    - _Requirements: 1.1, 3.2, 3.3_

  - [ ] 3.2 实现最近使用功能
    - 创建 UserEmojiPreferences 类管理用户偏好
    - 添加"最近使用"分类到表情选择器顶部
    - 实现表情使用频率统计和排序
    - _Requirements: 5.1, 5.2_

  - [ ] 3.3 添加表情搜索功能
    - 在表情选择器顶部添加搜索输入框
    - 实现表情符号的关键词匹配搜索
    - 支持拼音和英文关键词搜索表情
    - _Requirements: 5.3, 5.4_

- [ ]* 3.4 添加表情选择器动画效果
    - 实现表情选择器的展开收起动画
    - 添加分类切换的滑动动画效果
    - 优化表情点击的视觉反馈
    - _Requirements: 8.4_

- [ ] 4. 实现消息渲染组件
  - [ ] 4.1 创建 StickerMessageWidget 组件
    - 实现贴纸消息的专用渲染组件
    - 添加贴纸图片的异步加载和缓存
    - 实现贴纸消息的点击放大功能
    - _Requirements: 4.3, 4.4, 4.5_

  - [ ] 4.2 增强 EmojiMessageWidget 组件
    - 检测纯表情消息并使用大号显示
    - 优化混合文本和表情的渲染效果
    - 处理表情符号的行高和对齐问题
    - _Requirements: 6.3, 6.4_

  - [ ] 4.3 扩展 MessageBubble 组件
    - 更新消息气泡以支持新的消息类型
    - 为贴纸消息设计专门的气泡样式
    - 确保不同消息类型的一致性显示
    - _Requirements: 4.4, 9.4_

- [ ] 5. 集成表情功能到聊天界面
  - [ ] 5.1 更新消息输入组件
    - 在消息输入框旁添加表情按钮
    - 实现表情选择器的显示和隐藏逻辑
    - 支持表情符号插入到文本输入框
    - _Requirements: 1.1, 1.5_

  - [ ] 5.2 实现消息发送逻辑
    - 更新消息发送服务以支持贴纸消息
    - 实现贴纸消息的即时发送功能
    - 添加消息发送状态的视觉反馈
    - _Requirements: 2.1, 3.4_

  - [ ] 5.3 更新聊天消息列表
    - 修改消息列表以正确渲染表情和贴纸消息
    - 实现消息类型的动态识别和渲染
    - 确保消息历史记录的正确显示
    - _Requirements: 9.4, 8.1_

- [ ] 6. 服务端消息类型扩展
  - [ ] 6.1 扩展 Go 服务端消息模型
    - 更新 ChatRecord Ent schema 添加消息类型字段
    - 添加 StickerContent 结构体定义
    - 实现消息类型的验证逻辑
    - _Requirements: 9.1, 9.2_

  - [ ] 6.2 更新消息处理服务
    - 修改消息存储逻辑以支持新的消息类型
    - 实现贴纸消息内容的验证和存储
    - 更新消息检索 API 以返回完整的贴纸信息
    - _Requirements: 4.2, 9.5_

  - [ ] 6.3 扩展 WebSocket 消息处理
    - 更新 WebSocket 消息格式以支持贴纸内容
    - 实现贴纸消息的实时推送功能
    - 确保消息类型在传输过程中的完整性
    - _Requirements: 4.1, 4.2_

- [ ]* 6.4 添加消息类型验证测试
    - 编写贴纸消息验证的单元测试
    - 测试不同消息类型的存储和检索
    - 验证 WebSocket 消息传输的正确性
    - _Requirements: 9.1, 9.2_

- [ ] 7. 实现错误处理和优化
  - [ ] 7.1 添加客户端错误处理
    - 实现贴纸加载失败的错误处理
    - 添加网络错误时的消息重发机制
    - 处理图片缓存错误和清理逻辑
    - _Requirements: 7.5_

  - [ ] 7.2 实现性能优化
    - 添加贴纸包的懒加载机制
    - 实现图片预加载和内存管理
    - 优化表情选择器的渲染性能
    - _Requirements: 7.1, 7.2_

  - [ ] 7.3 添加跨平台兼容性处理
    - 确保表情符号在不同平台的一致显示
    - 处理不同屏幕密度的贴纸显示
    - 适配横屏模式的界面布局
    - _Requirements: 10.1, 10.3, 8.5_

- [ ]* 7.4 编写组件单元测试
    - 为 StickerManager 编写单元测试
    - 测试表情选择器的交互功能
    - 验证消息渲染组件的正确性
    - _Requirements: 所有功能需求_

- [ ] 8. 最终集成和测试
  - [ ] 8.1 集成所有功能模块
    - 确保表情和贴纸功能与现有聊天系统的无缝集成
    - 验证私聊和群聊中的表情贴纸功能
    - 测试消息历史记录中的表情贴纸显示
    - _Requirements: 2.3, 7.1, 8.1_

  - [ ] 8.2 进行端到端功能测试
    - 测试完整的表情消息发送和接收流程
    - 验证贴纸消息在不同设备间的同步
    - 确保离线消息中的表情贴纸正确显示
    - _Requirements: 2.1, 2.2, 4.1_

  - [ ]* 8.3 性能和稳定性测试
    - 测试大量贴纸加载时的内存使用情况
    - 验证长时间使用后的缓存清理效果
    - 检查不同网络条件下的功能稳定性
    - _Requirements: 7.1, 7.2, 7.3_